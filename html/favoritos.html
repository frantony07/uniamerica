<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pokémon Favoritos</title>
  <link rel="stylesheet" href="../styles/home.css">

  <!-- biblioteca de icones -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<style>
  body {
    background-color: white;
    font-family: 'Arial', sans-serif;
    text-align: center;
    color: #333;
    margin: 0;
    padding: 0;
  }

  h1 {
    color: #ff8c00;
    font-size: 2em;
    margin-top: 40px;
  }

  .estrela {
    justify-items: center;
    display: flex;
    color: #ffcc00;
    font-size: 1.4em;
  }

  .botao-favoritos {
    background: linear-gradient(90deg, #ffa500, #ff4500);
    color: white;
    border: none;
    border-radius: 30px;
    padding: 12px 30px;
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(255, 140, 0, 0.5);
    margin: 20px 0;
  }

 
  .vazio {
    width: 100px;
    height: 100px;
    border: 3px dashed #ccc;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #aaa;
    flex-direction: column;
  }

  .vazio i {
    font-size: 2em;
    color: #aaa;
  }

  #empty-state {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 60vh;
    width: 100%;
    text-align: center;
  }

  .box-instrucoes {
    background: #0d1b2a;
    color: white;
    width: 80%;
    max-width: 500px;
    margin: 40px auto;
    border-radius: 10px;
    padding: 20px;
    text-align: left;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  }

  .box-instrucoes ul {
    margin-top: 10px;
  }

  .box-instrucoes li {
    margin-bottom: 6px;
  }
</style>
</head>

<body>
  <div id="navbar-placeholder"></div>


  <h1><i class="fa-solid fa-star" style="color: #FFD43B;"></i>POKÉMON FAVORITOS <i class="fa-solid fa-star" style="color: #FFD43B;"></i></h1>
  <p>Sua coleção especial de Pokémon favoritos</p>

  <button id="btn-favoritos" class="botao-favoritos"><i class="fa-solid fa-heart"></i> 0 Pokémons Favoritos</button>

  <!-- Container where favorite cards will be rendered -->
  <div id="cards-container" class="d-flex flex-wrap justify-content-center gap-3" style="padding: 20px;">
    <!-- cards will be injected here -->
  </div>

  <!-- Empty state (centered) -->
  <div id="empty-state">
    <div id="vazio-box" class="vazio">
      <i><i class="fa-solid fa-star" style="color: #FFD43B;"></i></i>
      <p>Vazio</p>
    </div>

    <h3 id="nenhum-title">Nenhum Pokémon Favorito</h3>
    <p id="nenhum-desc">Você ainda não adicionou nenhum Pokémon aos seus favoritos.<br>
      Explore as categorias e clique na estrela para favoritar!</p>
  </div>

  <div class="box-instrucoes">
    <strong>Como adicionar favoritos:</strong>
    <ul>
      <li>Vá para a página "Categoria"</li>
      <li>Encontre um Pokémon que você gosta</li>
      <li>Clique na estrela para favoritar</li>
    </ul>
  </div>

</body>

<!-- Load navbar and keep all logic in plain JS (no module imports) -->
<script>
  // Carrega o navbar (arquivo local) e injeta no placeholder
  (async function loadNavbar(){
    try {
      const resp = await fetch('navbar.html');
      if (!resp.ok) throw new Error('Erro ao carregar navbar');
      const html = await resp.text();
      document.getElementById('navbar-placeholder').innerHTML = html;
    } catch (err) {
      console.error('Falha ao carregar navbar:', err);
    }
  })();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6P7c0f1F2a2x6N3C4a5B8E9D0F3F2d4D5C6E7F8G9H0I1J2K3L4M5N6O7P8Q9R" crossorigin="anonymous"></script>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const btnCount = document.getElementById('btn-favoritos');
    const cardsContainer = document.getElementById('cards-container');
    const emptyState = document.getElementById('empty-state');

    // Renderiza os favoritos lendo do localStorage e do arquivo pokemons.json
    async function renderizarFavoritos() {
      const raw = localStorage.getItem('pokemon_favoritos');
      const favoritosIds = raw ? JSON.parse(raw) : [];

      btnCount.innerHTML = `<i class="fa-solid fa-heart"></i> ${favoritosIds.length} Pokémons Favoritos`;

      if (!favoritosIds || favoritosIds.length === 0) {
        cardsContainer.style.display = 'none';
        emptyState.style.display = 'flex';
        cardsContainer.innerHTML = '';
        return;
      }

      // há favoritos
      emptyState.style.display = 'none';
      cardsContainer.style.display = 'flex';

      try {
        // Busca os dados diretamente da PokéAPI para cada ID favoritado
        const promises = favoritosIds.map(id =>
          fetch(`https://pokeapi.co/api/v2/pokemon/${id}`).then(r => {
            if (!r.ok) return null;
            return r.json();
          }).catch(() => null)
        );

        const results = await Promise.all(promises);
        const favoritosPokemons = results.filter(Boolean).map(p => ({
          id: p.id,
          name: p.name,
          photo_url: p.sprites?.front_default || '',
          type: p.types ? p.types.map(t => t.type.name) : [],
          base_stats: { hp: (p.stats && p.stats.find(s => s.stat.name === 'hp')) ? p.stats.find(s => s.stat.name === 'hp').base_stat : '' }
        }));

        // Render
        cardsContainer.innerHTML = '';
        favoritosPokemons.forEach(pokemon => {
          const card = document.createElement('div');
          card.className = 'card p-2';
          card.style.width = '220px';
          card.innerHTML = `
            <div class="card-header bg-warning text-dark"><strong>${pokemon.name}</strong></div>
            <div class="card-body text-center">
              <img src="${pokemon.photo_url}" alt="${pokemon.name}" style="width:120px;height:120px;object-fit:contain;">
              <p class="card-text">Tipo: ${pokemon.type.join(', ')}</p>
              <p class="card-text">HP: ${pokemon.base_stats.hp}</p>
              <div class="d-flex justify-content-between align-items-center mt-2">
                <a href="./detalhes.html?id=${pokemon.id}" class="btn btn-sm btn-primary">Detalhes</a>
                <button class="btn btn-sm btn-outline-danger" data-remove-id="${pokemon.id}"><i class="fa-solid fa-trash"></i></button>
              </div>
            </div>
          `;
          cardsContainer.appendChild(card);
        });

      } catch (err) {
        console.error('Erro ao carregar dados da PokéAPI', err);
        cardsContainer.innerHTML = '<p style="color: #333">Erro ao carregar pokémons.</p>';
      }
    }

    // Remove favorito (atualiza localStorage e re-renderiza)
    cardsContainer.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-remove-id]');
      if (!btn) return;
      const id = String(btn.getAttribute('data-remove-id'));
      const raw = localStorage.getItem('pokemon_favoritos');
      const favoritosIds = raw ? JSON.parse(raw) : [];
      const atualizado = favoritosIds.filter(fid => String(fid) !== id);
      localStorage.setItem('pokemon_favoritos', JSON.stringify(atualizado));
      renderizarFavoritos();
    });

    // Atualiza quando a aba recebe foco (útil após favoritar e voltar) ou quando localStorage muda em outra aba
    window.addEventListener('storage', (e) => {
      if (e.key === 'pokemon_favoritos') renderizarFavoritos();
    });
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') renderizarFavoritos();
    });

    // Inicializa
    renderizarFavoritos();
    // Polling: detecta mudanças no localStorage mesmo na mesma aba
    let ultimaVersaoRaw = localStorage.getItem('pokemon_favoritos');
    setInterval(() => {
      const atual = localStorage.getItem('pokemon_favoritos');
      if (atual !== ultimaVersaoRaw) {
        ultimaVersaoRaw = atual;
        renderizarFavoritos();
      }
    }, 1000);
  });
</script>


</html>