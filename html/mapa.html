<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapa Pokémon</title>
  <link rel="stylesheet" href="../styles/home.css">
  <link rel="import" href="../pokemons.json">
  <!-- biblioteca de icones -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="../styles/mapa.css">
</head>
<body class="d-flex flex-column min-vh-100">
  <div id="navbar-placeholder"></div>
  <div class="container flex-grow-1 d-flex align-items-center justify-content-center ">
      <div class="header-mapa">
        <div class="titulo-map">
          <i class="fa-regular fa-compass fa-3x" style="color: hsl(162, 76%, 29%);"></i>
          <h1>MAPA POKÉMON</h1>
          <i class="fa-regular fa-compass fa-3x" style="color: hsl(162, 76%, 29%);"></i>
        </div>
        <p class="subtitulo">Explore regiões e descubra Pokémon pelo mundo</p>

      <main class="d-flex flex-column flex-lg-row gap-4 justify-content-center align-items-start ">
         <section class="mapa">
        <h2>Mapa Interativo das Regiões</h2>
        <div class="mapa-area">
          <div class="ponto" data-region="Kanto" style="left: 20%; top: 30%; background-color: #dc2626;color: black">Kanto</div>
          <div class="ponto" data-region="Johto" style="left: 35%; top: 40%; background-color: #2563eb;color: black">Johto</div>
          <div class="ponto" data-region="Hoenn" style="left: 50%; top: 50%; background-color: #16a34a;color: black">Hoenn</div>
          <div class="ponto" data-region="Sinnoh" style="left: 65%; top: 60%; background-color: #9333ea;color: black">Sinnoh</div>
          <div class="ponto" data-region="Unova" style="left: 80%; top: 70%; background-color: #ca8a04;color: black">Unova</div>
          <div class="ponto" data-region="Kalos" style="left: 90%; top: 75%; background-color: #db2777;color: black">Kalos</div>
        </div>
      </section>

       <aside class="painel text-white">
        <h3>Regiões Disponíveis</h3>
        <ul>
          <li class="kanto ">Kanto</li>
          <li class="johto">Johto </li>
          <li class="hoenn">Hoenn </li>
          <li class="sinnoh">Sinnoh </li>
          <li class="unova">Unova </li>
          <li class="kalos">Kalos </li>
        </ul>

         <div id="info" class="mt-3">
          <h5>Selecione uma região para ver os Pokémons!</h5>
        </div>

      </aside>
      </main>

  </div>

</body>

<script>
  const regionToGenerationId = {
    Kanto: 1,   
    Johto: 2,  
    Hoenn: 3,   
    Sinnoh: 4,  
    Unova: 5,   
    Kalos: 6,   
   
  };

  // Fetch seguro
  async function fetchJson(url) {
    const resp = await fetch(url);
    if (!resp.ok) {
      const body = await resp.text();
      throw new Error(`HTTP ${resp.status}: ${body.slice(0, 120)}`);
    }
    const ct = resp.headers.get('content-type') || '';
    if (!ct.includes('application/json')) {
      const body = await resp.text();
      throw new Error(`Resposta não JSON (${ct}): ${body.slice(0, 120)}`);
    }
    return resp.json();
  }

  
  function extractIdFromUrl(url) {
    const parts = url.replace(/\/+$/, '').split('/');
    const idStr = parts[parts.length - 1];
    const id = Number(idStr);
    return Number.isFinite(id) ? id : null;
  }

  function capitalize(s) {
    if (!s || typeof s !== 'string') return s;
    return s.charAt(0).toUpperCase() + s.slice(1);
  }


   
  async function getPokemonSpeciesByGeneration(genId) {
    const data = await fetchJson(`https://pokeapi.co/api/v2/generation/${encodeURIComponent(genId)}/`);
    const species = (data.pokemon_species || [])
      .map(s => {
        const id = extractIdFromUrl(s.url);
        return { id, name: s.name, url: s.url };
      })
      .filter(sp => sp.id !== null)
      .sort((a, b) => a.id - b.id);
    return species;
  }

 
  function renderInfo(regionName, species) {
    const info = document.getElementById('info');
    if (!info) return;
    const count = Array.isArray(species) ? species.length : 0;

    info.innerHTML = `
      <h5>${regionName} — ${count} Pokémon</h5>
      ${
        count > 0
          ? `<ul>${species.map(sp => `<li>#${sp.id} ${capitalize(sp.name)}</li>`).join('')}</ul>`
          : `<p>Nenhum Pokémon encontrado nesta região.</p>`
      }
    `;
  }

  
  document.addEventListener('DOMContentLoaded', () => {
    const pontos = document.querySelectorAll('.ponto');
    const info = document.getElementById('info');

    pontos.forEach(ponto => {
     
      ponto.setAttribute('tabindex', '0');
      ponto.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          ponto.click();
        }
      });

      ponto.addEventListener('click', async () => {
        const region = ponto.getAttribute('data-region');
        const genId = regionToGenerationId[region];

        if (!genId) {
          renderInfo(region || 'Região', []);
          return;
        }

        if (info) {
          info.innerHTML = `<p>Carregando ${region}...</p>`;
        }

        try {
          const species = await getPokemonSpeciesByGeneration(genId);
          renderInfo(region, species);
        } catch (e) {
          console.error(e);
          if (info) {
            info.innerHTML = `<p>Erro ao carregar ${region}.</p>`;
          }
        }
      });
    });
  });
</script>


  </script>

<script type="module" src="../script/main.js"></script>
<script type="module" src="../script/letterString.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-C6P7c0f1F2a2x6N3C4a5B8E9D0F3F2d4D5C6E7F8G9H0I1J2K3L4M5N6O7P8Q9R" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

</html>